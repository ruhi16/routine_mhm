<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../partials/head'); %>
  </head>
  
  <body class="container">

    <header>
      <%- include('../partials/header'); %>
    </header>
    <%  const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        const d = new Date();
        let month = months[d.getMonth()];
        let today = days[d.getDay()];        
    %>

    <h1>Provitional Routine</h1>
    Session: <%= session.name %>
    Date: <%= (new Date()).toLocaleDateString('en-US') %>
    Month: <%= month %>
    Day: <%= today %>
    <br>

    <% teachers.forEach( teacher => {%>
      <!-- <%= teacher.name %>, -->
    <% });%>
    <br>
    <% provisionals.forEach( provisional => { %>
      <!-- <%= provisional.absentees %> -->
      <% provisional.absentees.map( trs =>{ %>
        <!-- <%= trs %> -->
      <% }) %>
    <% }); %>

    <% var n = Number(weekday.periods) %>

    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Name</th>          
                <!-- <%= n %> -->
            <% for (var i = 1; i <= n;  i++ ) { %>
              <th class="text-center"><%= i %></th>
            <% } %>
          <!-- <th scope="col">Reason </th>
          <th scope="col">Off Periods</th> -->
          <th scope="col" class="text-center">Actions
              <button type="button" id="btnAdd" class="btn btn-primary ml-5"  data-toggle="modal" data-target=".bd-example-modal-lg">Add</button>
              
          </th>
        </tr>
      </thead>
      <tbody>

        <% provisionals.forEach( provisional => { %>
          <!-- <%= provisional.absentees %> -->
          <% provisional.absentees.map( trs =>{ %>

            <tr>
              <td></td>
              <th scope="col">                
                <%= trs.teacher.name %><br>
                <p class="small">
                  <%= trs.reason %> [<%= trs.off_periods %>]
                </p>
              </th>

                <% var n = Number(weekday.periods) %>
                <!-- <%= n %> -->
                <% for (var i =1; i <= n;  i++ ) { %>
                  <td>
                    
                    <% sch = schedules.filter( schedule => { %>
                      <% return schedule.teacher.equals(trs.teacher) &&
                          schedule.period_no === i
                      %>
                    <% }); %>
                      
                    <% sch.forEach( sc => { %>
                      <%= sc.class.name %>-<%= sc.section.name %><br>
                      <p class="small"> <%= sc.subject.name %></p>
                    <% }); %>

                  </td>                  
                <% } %>
              

              
              <!-- <th scope="col">
                <%= trs.reason %>
              </th>
              <td>
                <%= trs.off_periods %>
              </td> -->
              
              <td>
                <button class="btn btn-warning">Present</button>
              </td>
            </tr>
            <!-- xx<%= trs %>xx -->
            <!-- // =================== -->
            <tr>
              <th></th>
              <th scope="col">
                <p class="small"></p>
              </th>              
              <% var n = Number(weekday.periods) %>                
              <% for (var i =1; i <= n;  i++ ) { %>
                <td></td>
              <% } %>
              
              <td></td>
            </tr>

          <% }) %>
        <% }); %>

      </tbody>
    </table>
    

      <div class="row">
        <div class="col-md-12 text-right">
            <button type="button" class="btn btn-success">Cancel</button>
            <button type="button" class="btn btn-primary">Submit</button>            
        </div>
      </div>

      <% schedules.forEach(schedule=>{%>
        <%= schedule.teacher.name %><br/>
      <% }); %>




      <!-- modal -->
      <div class="modal fade bd-example-modal-lg" id="modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">

            <form action="#" method="post">
              <div class="modal-header">Title</div>
              <div class="modal-body">
      
              
      

      
                
                <div class="form-group row">
                  <label for="teacher" class="col-sm-2 col-form-label">Teacher</label>
                  <div class="col-sm-10">
                    <select class="form-control" id="teacher" name="teacher">
                      
      
                    </select>
                  </div>
                </div>
      
                <div class="form-group row">
                  <label for="reason" class="col-sm-2 col-form-label">Reason</label>
                  <div class="col-sm-10">
                    <select class="form-control" id="reason" name="reason">
                      <option name="" value="">Select</option>
                      <option name="reason[]" value="absent">Absent</option>
                      <option name="reason[]" value="onduty">Onduty</option>
                      <option name="reason[]" value="medical">Medical Leave</option>
                    </select>
                  </div>
                </div>

                <div class="form-group row">
                  <label for="reason" class="col-sm-2 col-form-label">Periods</label>
                  <!-- <div class="col-sm-10"> -->

                    <div class="col-sm-1 form-check-inline">
                      <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" name="periods[]" value="1">1st
                      </label>
                    </div>
                    <div class="col-sm-1 form-check-inline">
                      <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" name="periods[]" value="2">2nd
                      </label>
                    </div>
                    <div class="col-sm-1 form-check-inline">
                      <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" name="periods[]" value="3">3rd
                      </label>
                    </div>
                    <div class="col-sm-1 form-check-inline">
                      <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" name="periods[]" value="4">4th
                      </label>
                    </div>
                    <div class="col-sm-1 form-check-inline">
                      <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" name="periods[]" value="5">5th
                      </label>
                    </div>
                    <div class="col-sm-1 form-check-inline">
                      <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" name="periods[]" value="6">6th
                      </label>
                    </div>
                    <div class="col-sm-1 form-check-inline">
                      <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" name="periods[]" value="7">7th
                      </label>
                    </div>
                    <div class="col-sm-1 form-check-inline">
                      <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" name="periods[]" value="8">8th
                      </label>
                    </div>
                  <!-- </div> -->

                </div>
                

                <!-- <div class="form-group">
                  <label for="exampleInputEmail1">Email address</label>
                  <input type="email" class="form-control" name="email" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
                  <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
                </div>
                <div class="form-group">
                  <label for="exampleInputPassword1">Password</label>
                  <input type="password" class="form-control" name="password" id="exampleInputPassword1" placeholder="Password">
                </div>
                <div class="form-group form-check">
                  <input type="checkbox" class="form-check-input" name="checked" id="exampleCheck1">
                  <label class="form-check-label" for="exampleCheck1">Check me out</label>
                </div> -->
                
                
            </div>
            <div class="modal-footer">        
              <button class="btn btn-info float-right mr-2" data-dismiss="modal">Cancel</button>
              <button type="submit" id="btnSubmit" class="btn btn-warning float-right">Submit</button>
                
              
              <!-- <a class="btn btn-danger" data-dismiss="modal" value="Close" >Close</a> -->
            </div>
          </form>
          </div>
        </div>
      </div>

    <footer>
      <%- include('../partials/footer'); %>
    </footer>


  <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
  <script type="text/javascript">

  </script>

  </body>
</html>


<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>

<script type="text/javascript" >
  $(document).ready(function(e){
    $('#btnAdd').click(function(){
      var teachers = '<%- JSON.stringify(teachers) %>';
      var teachersObj = JSON.parse(teachers);
      // alert('hhh');

      $('#teacher').empty();
      $('#teacher').append('<option name="" value="">Select</option>');
      for (const teacher of teachersObj) {     
        // if(!allotedTeachersArr.includes(teacher._id)){        
          $('#teacher').append('<option value = "'+ teacher._id +'">'+ teacher.name +'</option>');        
        // }
     
    }

    });

    $('#btnSubmit').click(function(e){

      // alert('submit');
      // $('.modal:visible').modal('toggle');
    });

    // $('#modal').on('shown.bs.modal', function () {
    // alert('submit');
    //   $('#teacher').trigger('focus')
    // });
    $("form").on("submit", function(event){
      event.preventDefault();
      // alert('submit');
      var tech = $('#teacher').val();
      var resn = $('#reason').val();
      
      var array = [];
      $("input:checkbox[name=periods]:checked").each(function() {
          array.push($(this).val());
          alert($(this).val());
          // array.push();
      });
      // alert(tech+'='+resn+'='+array);

      $.ajax({
        url: "/provisional/ajax/teacher-submit",
        method: "post",
        // dataType: "json",
        // async: false,
        contentType: "application/json",
        data: JSON.stringify({
            teacher: tech, reason: resn
        }),

        success: function(msg){
          console.log("success ajax:" + msg.response );
          // console.log("success ajax:" + JSON.stringify(msg) );
        },
        error: function(err){
          console.log("error:"+err);
        }
      });





    });

  });
</script>